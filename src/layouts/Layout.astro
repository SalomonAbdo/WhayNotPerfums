---
// src/layouts/Layout.astro
import '@fontsource/playfair-display';
import '@fontsource/inter';
import '../styles/global.css'; // <-- Agrega esta línea
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import AuthModal from '../components/AuthModal.astro'; // Importamos el modal

interface Props {
	title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="es">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width" />
	<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
	<title>{title}</title>
</head>
<body class="flex flex-col min-h-screen">
<Navbar />
<AuthModal /> <!-- Insertamos el modal globalmente -->

<!-- Global Toast Notification (Centered) -->
<div id="global-alert-overlay" class="fixed inset-0 z-[100] flex items-center justify-center pointer-events-none">
    <div id="global-alert-box" class="bg-white pointer-events-auto w-full max-w-sm rounded-lg shadow-2xl opacity-0 scale-95 transition-all duration-300 border-l-4 overflow-hidden transform">
        <div class="p-6 flex items-center gap-4">
            <!-- Icon -->
            <div id="alert-icon" class="flex-shrink-0">
                <!-- Icon injected by JS -->
            </div>

            <!-- Content -->
            <div class="flex-1 pt-0.5">
                <h3 id="alert-title" class="text-sm font-bold text-gray-900 leading-none mb-1"></h3>
                <p id="alert-message" class="text-sm text-gray-600 leading-snug"></p>
            </div>

            <!-- Close Button -->
            <button id="alert-close-btn" class="flex-shrink-0 text-gray-400 hover:text-gray-600">
                 <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>
        <!-- Progress Bar (Optional visual touch) -->
        <div id="alert-accent-bar" class="h-1 w-full bg-gray-200 hidden"></div>
    </div>
</div>

<div class="flex-grow">
    <slot />
</div>
<Footer />

<script is:inline>
  window.showToast = (message, type = 'success') => {
      const overlay = document.getElementById('global-alert-overlay');
      const box = document.getElementById('global-alert-box');
      const iconContainer = document.getElementById('alert-icon');
      const titleEl = document.getElementById('alert-title');
      const messageEl = document.getElementById('alert-message');
      const closeBtn = document.getElementById('alert-close-btn');

      if (!box) return;

      // Configuración según tipo
      if (type === 'error') {
          box.className = 'bg-white pointer-events-auto w-full max-w-sm rounded-lg shadow-2xl opacity-0 scale-95 transition-all duration-300 border-l-4 overflow-hidden transform border-red-500';
          iconContainer.innerHTML = '<svg class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" /></svg>';
          titleEl.textContent = 'Error';
      } else {
          box.className = 'bg-white pointer-events-auto w-full max-w-sm rounded-lg shadow-2xl opacity-0 scale-95 transition-all duration-300 border-l-4 overflow-hidden transform border-green-500';
          iconContainer.innerHTML = '<svg class="h-8 w-8 text-green-500" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" /></svg>';
          titleEl.textContent = 'Éxito';
      }

      messageEl.textContent = message;

      // Mostrar (Wait a tick to allow browser to register initial class state if reused immediately)
      requestAnimationFrame(() => {
          box.classList.remove('opacity-0', 'scale-95');
          box.classList.add('opacity-100', 'scale-100');
      });

      // Función para cerrar
      const hideAlert = () => {
          box.classList.add('opacity-0', 'scale-95');
          box.classList.remove('opacity-100', 'scale-100');
      };

      // Cerrar al click en botón
      if(closeBtn) {
          closeBtn.onclick = hideAlert;
      }

      // Auto cerrar despues de un tiempo
      if (window.alertTimer) clearTimeout(window.alertTimer);
      window.alertTimer = setTimeout(hideAlert, 4000);
  };
</script>
</body>

<style is:global>
	/* Esto asegura que la fuente base sea Inter */
	body {
		font-family: 'Inter', sans-serif;
	}
</style>